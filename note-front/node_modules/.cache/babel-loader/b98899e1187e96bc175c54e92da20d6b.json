{"remainingRequest":"D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\node_modules\\.store\\babel-loader@8.3.0\\node_modules\\babel-loader\\lib\\index.js!D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\node_modules\\.store\\cache-loader@4.1.0\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\node_modules\\.store\\vue-loader@15.11.1\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\src\\views\\notes\\childrens\\NoteCommentContainer.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\src\\views\\notes\\childrens\\NoteCommentContainer.vue","mtime":1703320567681},{"path":"D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\babel.config.js","mtime":1703320567604},{"path":"D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\node_modules\\.store\\cache-loader@4.1.0\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\node_modules\\.store\\babel-loader@8.3.0\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\node_modules\\.store\\cache-loader@4.1.0\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\2718075060\\Desk\\sspku\\云计算\\Note\\note-front\\node_modules\\.store\\vue-loader@15.11.1\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IE5vdGVDb21tZW50TGlzdCBmcm9tICcuL05vdGVDb21tZW50TGlzdC52dWUnOwppbXBvcnQgeyBnZXRDb21tZW50QnlOb3RlSWQsIGdldENvbW1lbnRMaWtlUmVsYXRpb24sIHNhdmVDb21tZW50IH0gZnJvbSAnQC9uZXR3b3JrL25vdGUvaW5kZXguanMnOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbW1lbnRDb250ZW50OiAnJywKICAgICAgY29tbWVudERhdGE6IFtdLAogICAgICBsaWtlUmVsYXRpb246IFtdLAogICAgICBpc1JlcGx5OiBmYWxzZSwKICAgICAgY3VycmVudFJlcGx5RGF0YToge30KICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXREYXRhKCk7CiAgfSwKICBjb21wdXRlZDogewogICAgLy8g5qC55o2u6K+E6K66aWTljrvljLnphY3lr7nlupTnmoRsaWtlCiAgICBnZXRMaWtlRGF0YSgpIHsKICAgICAgaWYgKCF0aGlzLmxpa2VSZWxhdGlvbikgcmV0dXJuICgpID0+ICh7fSk7CiAgICAgIHJldHVybiBpdGVtID0+IHsKICAgICAgICByZXR1cm4gdGhpcy5saWtlUmVsYXRpb24uZmluZChsaWtlSXRlbSA9PiBsaWtlSXRlbS5pZCA9PT0gaXRlbS5pZCk7CiAgICAgIH07CiAgICB9LAogICAgcmVwbHlQbGFjZWhvbGRlcigpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNSZXBseSA/IGBSZXBseSBAJHt0aGlzLmN1cnJlbnRSZXBseURhdGEudXNlck5hbWV9YCA6ICdQb3N0IEEgRnJpZW5kbHkgQ29tbWVudCc7CiAgICB9LAogICAgaXNMb2dpbigpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvOwogICAgfSwKICAgIGN1cnJlbnRVc2VyQXZhdGFyKCkgewogICAgICBpZiAoIXRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvKSByZXR1cm4gJ2h0dHBzOi8vY3ViZS5lbGVtZWNkbi5jb20vMC84OC8wM2IwZDM5NTgzZjQ4MjA2NzY4YTc1MzRlNTViY3BuZy5wbmcnOwogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlckluZm8uYXZhdGFyVXJsOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgZ2V0RGF0YSgpIHsKICAgICAgY29uc3QgewogICAgICAgIGRhdGEKICAgICAgfSA9IGF3YWl0IGdldENvbW1lbnRCeU5vdGVJZCh0aGlzLiRyb3V0ZS5xdWVyeS5pZCk7CiAgICAgIHRoaXMuY29tbWVudERhdGEgPSBkYXRhOwogICAgICBjb25zdCB7CiAgICAgICAgZGF0YTogcmVsYXRpb25EYXRhCiAgICAgIH0gPSBhd2FpdCB0aGlzLmdldExpa2VSZWxhdGlvbigpOwogICAgICB0aGlzLmxpa2VSZWxhdGlvbiA9IHJlbGF0aW9uRGF0YTsKICAgIH0sCiAgICBnZXRMaWtlUmVsYXRpb24oKSB7CiAgICAgIHZhciBfdGhpcyQkc3RvcmUkc3RhdGUkdXM7CiAgICAgIHJldHVybiBnZXRDb21tZW50TGlrZVJlbGF0aW9uKChfdGhpcyQkc3RvcmUkc3RhdGUkdXMgPSB0aGlzLiRzdG9yZS5zdGF0ZS51c2VySW5mbykgPT09IG51bGwgfHwgX3RoaXMkJHN0b3JlJHN0YXRlJHVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyQkc3RvcmUkc3RhdGUkdXMudXNlcmlkLCB0aGlzLiRyb3V0ZS5xdWVyeS5pZCk7CiAgICB9LAogICAgcG9zdENvbW1lbnQoKSB7CiAgICAgIGxldCBjb21tZW50RGF0YSA9IHsKICAgICAgICB1c2VySWQ6IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvLnVzZXJpZCwKICAgICAgICBjb21tZW50Q29udGVudDogdGhpcy5jb21tZW50Q29udGVudCwKICAgICAgICBub3RlSWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkCiAgICAgIH07CiAgICAgIGlmICh0aGlzLmNvbW1lbnRDb250ZW50Lmxlbmd0aCA+IDEzMCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn6K+E6K665YaF5a656ZW/5bqm5LiN6IO96LaF6L+HMTMw5Liq5a2X56ymJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmNvbW1lbnRDb250ZW50LnRyaW0oKS5sZW5ndGggPT0gMCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn5LiN6IO95Y+R56m655m95YaF5a65Jyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmlzUmVwbHkpIHsKICAgICAgICBjb21tZW50RGF0YS5wYXJlbnRJZCA9IHRoaXMuY3VycmVudFJlcGx5RGF0YS5wYXJlbnRJZCA9PSAwID8gdGhpcy5jdXJyZW50UmVwbHlEYXRhLmlkIDogdGhpcy5jdXJyZW50UmVwbHlEYXRhLnBhcmVudElkOwogICAgICAgIGNvbW1lbnREYXRhLnJlcGx5SWQgPSB0aGlzLmN1cnJlbnRSZXBseURhdGEuaWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29tbWVudERhdGEucGFyZW50SWQgPSAwOwogICAgICAgIGNvbW1lbnREYXRhLnJlcGx5SWQgPSAwOwogICAgICB9CiAgICAgIHNhdmVDb21tZW50KGNvbW1lbnREYXRhKS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLmlzUmVwbHkgPSBmYWxzZTsKICAgICAgICB0aGlzLmNvbW1lbnRDb250ZW50ID0gJyc7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCflj5HluIPor4TorrrmiJDlip8nKTsKICAgICAgICB0aGlzLmdldERhdGEoKTsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgcmVsb2FkTGlrZURhdGEoKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiByZWxhdGlvbkRhdGEKICAgICAgfSA9IGF3YWl0IHRoaXMuZ2V0TGlrZVJlbGF0aW9uKCk7CiAgICAgIHJlbGF0aW9uRGF0YS5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4gewogICAgICAgIHRoaXMuJHNldCh0aGlzLmxpa2VSZWxhdGlvbiwgaW5kZXgsIGl0ZW0pOwogICAgICB9KTsKICAgIH0sCiAgICByZXBseVVzZXIocmVwbHlDb21tZW50RGF0YSkgewogICAgICBpZiAoIXRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfor7fnmbvlvZXkuYvlkI7lho3ov5vooYzmk43kvZwnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29tbWVudENvbnRlbnQpIHRoaXMuY29tbWVudENvbnRlbnQgPSAnJzsKICAgICAgdGhpcy5jdXJyZW50UmVwbHlEYXRhID0gcmVwbHlDb21tZW50RGF0YTsKICAgICAgdGhpcy5pc1JlcGx5ID0gdHJ1ZTsKICAgICAgdGhpcy4kcmVmcy5wb3N0Q29tbWVudElucHV0UmVmLmZvY3VzKCk7CiAgICB9LAogICAgcmVsb2FkQ29tbWVudCgpIHsKICAgICAgdGhpcy5nZXREYXRhKCk7CiAgICB9CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBOb3RlQ29tbWVudExpc3QKICB9Cn07"},{"version":3,"names":["NoteCommentList","getCommentByNoteId","getCommentLikeRelation","saveComment","data","commentContent","commentData","likeRelation","isReply","currentReplyData","created","getData","computed","getLikeData","item","find","likeItem","id","replyPlaceholder","userName","isLogin","$store","state","userInfo","currentUserAvatar","avatarUrl","methods","$route","query","relationData","getLikeRelation","_this$$store$state$us","userid","postComment","userId","noteId","length","$message","warning","trim","parentId","replyId","then","success","reloadLikeData","forEach","index","$set","replyUser","replyCommentData","$refs","postCommentInputRef","focus","reloadComment","components"],"sources":["src/views/notes/childrens/NoteCommentContainer.vue"],"sourcesContent":["<template>\r\n  <div class=\"comment-container\">\r\n    <div class=\"self-comment\" v-if=\"isLogin\">\r\n      <div>\r\n        <el-avatar :size=\"60\" :src=\"currentUserAvatar\"> </el-avatar>\r\n      </div>\r\n      <div style=\"width: 60%\">\r\n        <el-input\r\n          ref=\"postCommentInputRef\"\r\n          :placeholder=\"replyPlaceholder\"\r\n          v-model=\"commentContent\"\r\n        >\r\n        </el-input>\r\n      </div>\r\n      <div>\r\n        <el-button type=\"primary\" size=\"medium\" @click=\"postComment\"\r\n          >Post Comment</el-button\r\n        >\r\n      </div>\r\n    </div>\r\n    <div v-else class=\"login-tip\">\r\n      <el-link type=\"primary\" :underline=\"false\" href=\"/login\"\r\n        >登录之后才能进行评论，点我跳转登录页面</el-link\r\n      >\r\n    </div>\r\n    <div class=\"comments\">\r\n      <div v-if=\"commentData.length != 0\">\r\n        <NoteCommentList\r\n          v-for=\"(item, index) in commentData\"\r\n          :key=\"index\"\r\n          :listData=\"item\"\r\n          :likeData=\"getLikeData(item)\"\r\n          @reloadLikeData=\"reloadLikeData\"\r\n          @replyUser=\"replyUser\"\r\n          @reloadComment=\"reloadComment\"\r\n        />\r\n      </div>\r\n      <div v-else style=\"text-align: center\">当前笔记下还未有评论~</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport NoteCommentList from './NoteCommentList.vue'\r\nimport {\r\n  getCommentByNoteId,\r\n  getCommentLikeRelation,\r\n  saveComment\r\n} from '@/network/note/index.js'\r\nexport default {\r\n  data() {\r\n    return {\r\n      commentContent: '',\r\n      commentData: [],\r\n      likeRelation: [],\r\n      isReply: false,\r\n      currentReplyData: {}\r\n    }\r\n  },\r\n  created() {\r\n    this.getData()\r\n  },\r\n  computed: {\r\n    // 根据评论id去匹配对应的like\r\n    getLikeData() {\r\n      if (!this.likeRelation) return () => ({})\r\n      return (item) => {\r\n        return this.likeRelation.find((likeItem) => likeItem.id === item.id)\r\n      }\r\n    },\r\n    replyPlaceholder() {\r\n      return this.isReply\r\n        ? `Reply @${this.currentReplyData.userName}`\r\n        : 'Post A Friendly Comment'\r\n    },\r\n    isLogin() {\r\n      return this.$store.state.userInfo\r\n    },\r\n    currentUserAvatar() {\r\n      if (!this.$store.state.userInfo)\r\n        return 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'\r\n      return this.$store.state.userInfo.avatarUrl\r\n    }\r\n  },\r\n  methods: {\r\n    async getData() {\r\n      const { data } = await getCommentByNoteId(this.$route.query.id)\r\n      this.commentData = data\r\n      const { data: relationData } = await this.getLikeRelation()\r\n      this.likeRelation = relationData\r\n    },\r\n    getLikeRelation() {\r\n      return getCommentLikeRelation(\r\n        this.$store.state.userInfo?.userid,\r\n        this.$route.query.id\r\n      )\r\n    },\r\n    postComment() {\r\n      let commentData = {\r\n        userId: this.$store.state.userInfo.userid,\r\n        commentContent: this.commentContent,\r\n        noteId: this.$route.query.id\r\n      }\r\n      if (this.commentContent.length > 130) {\r\n        this.$message.warning('评论内容长度不能超过130个字符')\r\n        return\r\n      }\r\n      if (this.commentContent.trim().length == 0) {\r\n        this.$message.warning('不能发空白内容')\r\n        return\r\n      }\r\n      if (this.isReply) {\r\n        commentData.parentId =\r\n          this.currentReplyData.parentId == 0\r\n            ? this.currentReplyData.id\r\n            : this.currentReplyData.parentId\r\n        commentData.replyId = this.currentReplyData.id\r\n      } else {\r\n        commentData.parentId = 0\r\n        commentData.replyId = 0\r\n      }\r\n      saveComment(commentData).then(() => {\r\n        this.isReply = false\r\n        this.commentContent = ''\r\n        this.$message.success('发布评论成功')\r\n        this.getData()\r\n      })\r\n    },\r\n    async reloadLikeData() {\r\n      const { data: relationData } = await this.getLikeRelation()\r\n      relationData.forEach((item, index) => {\r\n        this.$set(this.likeRelation, index, item)\r\n      })\r\n    },\r\n    replyUser(replyCommentData) {\r\n      if (!this.$store.state.userInfo) {\r\n        this.$message.warning('请登录之后再进行操作')\r\n        return\r\n      }\r\n\r\n      if (this.commentContent) this.commentContent = ''\r\n      this.currentReplyData = replyCommentData\r\n      this.isReply = true\r\n      this.$refs.postCommentInputRef.focus()\r\n    },\r\n    reloadComment() {\r\n      this.getData()\r\n    }\r\n  },\r\n  components: { NoteCommentList }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.comment-container {\r\n  padding: 40px 20px;\r\n  .self-comment {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 15px;\r\n  }\r\n  .login-tip {\r\n    height: 30px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .comments {\r\n    border-top: 1px solid #d9d9da;\r\n    padding-top: 40px;\r\n    margin-left: 30px;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"AA2CA,OAAAA,eAAA;AACA,SACAC,kBAAA,EACAC,sBAAA,EACAC,WAAA,QACA;AACA;EACAC,KAAA;IACA;MACAC,cAAA;MACAC,WAAA;MACAC,YAAA;MACAC,OAAA;MACAC,gBAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,OAAA;EACA;EACAC,QAAA;IACA;IACAC,YAAA;MACA,UAAAN,YAAA;MACA,OAAAO,IAAA;QACA,YAAAP,YAAA,CAAAQ,IAAA,CAAAC,QAAA,IAAAA,QAAA,CAAAC,EAAA,KAAAH,IAAA,CAAAG,EAAA;MACA;IACA;IACAC,iBAAA;MACA,YAAAV,OAAA,GACA,eAAAC,gBAAA,CAAAU,QAAA,KACA;IACA;IACAC,QAAA;MACA,YAAAC,MAAA,CAAAC,KAAA,CAAAC,QAAA;IACA;IACAC,kBAAA;MACA,UAAAH,MAAA,CAAAC,KAAA,CAAAC,QAAA,EACA;MACA,YAAAF,MAAA,CAAAC,KAAA,CAAAC,QAAA,CAAAE,SAAA;IACA;EACA;EACAC,OAAA;IACA,MAAAf,QAAA;MACA;QAAAP;MAAA,UAAAH,kBAAA,MAAA0B,MAAA,CAAAC,KAAA,CAAAX,EAAA;MACA,KAAAX,WAAA,GAAAF,IAAA;MACA;QAAAA,IAAA,EAAAyB;MAAA,eAAAC,eAAA;MACA,KAAAvB,YAAA,GAAAsB,YAAA;IACA;IACAC,gBAAA;MAAA,IAAAC,qBAAA;MACA,OAAA7B,sBAAA,EAAA6B,qBAAA,GACA,KAAAV,MAAA,CAAAC,KAAA,CAAAC,QAAA,cAAAQ,qBAAA,uBAAAA,qBAAA,CAAAC,MAAA,EACA,KAAAL,MAAA,CAAAC,KAAA,CAAAX,EACA;IACA;IACAgB,YAAA;MACA,IAAA3B,WAAA;QACA4B,MAAA,OAAAb,MAAA,CAAAC,KAAA,CAAAC,QAAA,CAAAS,MAAA;QACA3B,cAAA,OAAAA,cAAA;QACA8B,MAAA,OAAAR,MAAA,CAAAC,KAAA,CAAAX;MACA;MACA,SAAAZ,cAAA,CAAA+B,MAAA;QACA,KAAAC,QAAA,CAAAC,OAAA;QACA;MACA;MACA,SAAAjC,cAAA,CAAAkC,IAAA,GAAAH,MAAA;QACA,KAAAC,QAAA,CAAAC,OAAA;QACA;MACA;MACA,SAAA9B,OAAA;QACAF,WAAA,CAAAkC,QAAA,GACA,KAAA/B,gBAAA,CAAA+B,QAAA,QACA,KAAA/B,gBAAA,CAAAQ,EAAA,GACA,KAAAR,gBAAA,CAAA+B,QAAA;QACAlC,WAAA,CAAAmC,OAAA,QAAAhC,gBAAA,CAAAQ,EAAA;MACA;QACAX,WAAA,CAAAkC,QAAA;QACAlC,WAAA,CAAAmC,OAAA;MACA;MACAtC,WAAA,CAAAG,WAAA,EAAAoC,IAAA;QACA,KAAAlC,OAAA;QACA,KAAAH,cAAA;QACA,KAAAgC,QAAA,CAAAM,OAAA;QACA,KAAAhC,OAAA;MACA;IACA;IACA,MAAAiC,eAAA;MACA;QAAAxC,IAAA,EAAAyB;MAAA,eAAAC,eAAA;MACAD,YAAA,CAAAgB,OAAA,EAAA/B,IAAA,EAAAgC,KAAA;QACA,KAAAC,IAAA,MAAAxC,YAAA,EAAAuC,KAAA,EAAAhC,IAAA;MACA;IACA;IACAkC,UAAAC,gBAAA;MACA,UAAA5B,MAAA,CAAAC,KAAA,CAAAC,QAAA;QACA,KAAAc,QAAA,CAAAC,OAAA;QACA;MACA;MAEA,SAAAjC,cAAA,OAAAA,cAAA;MACA,KAAAI,gBAAA,GAAAwC,gBAAA;MACA,KAAAzC,OAAA;MACA,KAAA0C,KAAA,CAAAC,mBAAA,CAAAC,KAAA;IACA;IACAC,cAAA;MACA,KAAA1C,OAAA;IACA;EACA;EACA2C,UAAA;IAAAtD;EAAA;AACA"}]}